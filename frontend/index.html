<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="fonts/icomoon/style.css">

    <link rel="stylesheet" href="css/owl.carousel.min.css">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    
    <!-- Style -->
    <link rel="stylesheet" href="css/style.css">
    <style>
        #ctnqrCode{
            margin-top: 5rem;
            break-inside: avoid;
        }

        #result p{
            color: rgb(54, 54, 54);
        }
    </style>

    <title>Encontro Motociclístico da Polícia Militar do Distrito Federal</title>
</head>
<body>


  <div class="d-lg-flex half">
    <div class="bg order-1 order-md-2" style="background-image: url('img/fundomotos.jpeg');"></div>
    <div class="contents order-2 order-md-1">

      <div class="container">
        <div class="row align-items-center justify-content-center">
          <div class="col-md-7 py-5">
            <h3>Encontro Motociclístico da PMDF</h3>
            <p class="mb-4" style="color: rgb(32, 32, 32);">Inscrição mediante a doação de um quilo de alimento não perecível (exceto sal).</p>

              <p class="mb-4" style="color: rgb(32, 32, 32);">   Salve ou imprima o QRCODE gerado após a inscrição para apresentar no dia do evento.</p>
            <p class="mb-4" style="color: rgb(32, 32, 32);">Data: 04/05/24
              Local: <a href="https://maps.app.goo.gl/EroU6bEkijTeUCDk8?g_st=ic">Estacionamento do complexo ibero-americano</a> (antiga FUNARTE)
              
              Horário:
              Concentração 14h -
              Passeio Motociclístico 16h -
              Encerramento 19h - Informações 61 - 992697262</p>
            <form id="dataForm">
               
                  <div class="row">
                    <div class="col-md-12">
                        <div class="form-group first">
                          <label for="nome">Nome Completo</label>
                          <input type="text" class="form-control"  placeholder="Infome o nome completo" id="nome" name="nome">
                        </div>    
                      </div>
                    </div>

              <div class="row">
                
                <div class="col-md-6">
                  <div class="form-group first">
                    <label for="cpf">CPF</label>
                    <input type="text" class="form-control" placeholder="Infome o nome cpf"  id="cpf" name="cpf" maxlength="14" >
                  </div>    
                </div>
                <div class="col-md-6">
                    <div class="form-group first">
                      <label for="numeroCnh">Número da CNH</label>
                      <input type="text" class="form-control"  placeholder="Infome a cnh"  id="numeroCnh" name="numeroCnh">
                    </div>    
                  </div>
              </div>

              <div class="row">
                <div class="col-md-8">
                  <div class="form-group first">
                    <label for="email">Email</label>
                    <input type="email" class="form-control" placeholder="Infome o email" id="email" name="email">
                  </div>    
                </div>
                <div class="col-md-4">
                    <div class="form-group first">
                      <label for="telefone">Telefone</label>
                      <input type="text" class="form-control" placeholder="Infome o telefone" id="telefone" name="telefone">
                    </div>    
                  </div>
              </div>
              <div class="row">
                <div class="col-md-12">
                    <div class="form-group first">
                        <label for="endereco">Endereco</label>
                        <input type="text" class="form-control" placeholder="Infome o endereco" id="endereco" name="endereco">
                      </div>   
                </div>
              </div>
              <div class="row">
          
                <div class="col-md-6">
                  <div class="form-group first">
                    <label for="marca">Marca</label>
                    <input type="text" class="form-control" placeholder="Infome a marca da moto" id="marca" name="marca">
                  </div>    
                </div>
                <div class="col-md-6">
                    <div class="form-group first">
                      <label for="modelo">Modelo</label>
                      <input type="text" class="form-control" placeholder="Infome o modelo da moto" id="modelo" name="modelo">
                    </div>    
                  </div>
              </div>
              <div class="row">
                <div class="col-md-6">
                    <div class="form-group first">
                      <label for="placaMoto">Placa da moto</label>
                      <input type="text" class="form-control" placeholder="Placa (sem espaço em branco)" id="placaMoto" name="placaMoto">
                    </div>    
                  </div>
                <div class="col-md-6">
                    <div class="form-group first">
                      <label for="tipoSanguineo">Tipo Sanguíneo</label>
                      <input type="text" class="form-control" placeholder="Infome o tipo sanquíneo" id="tipoSanguineo" name="tipoSanguineo">
                    </div>    
                  </div>
              </div> 
              
              <div class="row">
                <a href="/termo.html" 
                style="background-color: white; color: blue;"
                target="_blank">Leia o termo de inscrição clicando aqui.</a>
                </div>


              <div class="d-flex mb-5 mt-4 align-items-center">
                <div class="d-flex align-items-center">
                <label class="control control--checkbox mb-0"><span class="caption">Confimo a leitura e concordância com Termo de Inscrição?</span>
                  <input type="checkbox" id="meuCheckbox"/>
                  <div class="control__indicator"></div>
                </label>
              </div>
              </div>

              <button id="btnSave" type="submit" class="btn px-5 btn-primary">Cadastrar</button>

              <div class="row">
                <div class="col-md-12">
                  <div id="ctnqrCode" >
                    <hr>
                    <div>
                        <h1>Comprovante de inscrição</h1>
                        <h3>Favor imprimir:</h3>
                          <div class="row">
                            <div class="col-md-6">
                              <input type="button" class="btn  btn btn-success" id="btn"
                                onclick="salvarPrintscreen()" value="Salvar Comprovante"></input>         
                    
                            </div>
                            <div class="col-md-6">
                              <input type="button" class="btn btn btn-success" 
                              id="bt" onclick="print()" value="Imprimir" />
                            </div>  
                          </div>
                     
                            <h5>Não esqueça de imprimir e levar o comprovante.        </h5>    
                            <h5>ENTRADA CONDICIONADA A APRESENTAÇÃO DO COMPROVANTE!</h5>   
                    </div>
                    <div id="qrCodeContainer" class="row">

                        <div id="result">
                            <p>Nome:<input id="resultNome" disabled="true" /></p>
                            <p>CPF:<input id="resultCPF" disabled="true"/></p>
                            <p>Placa da moto:<input id="resultPlaca" disabled="true"/></p>
                        </div>
                    </div>
    
                  </div>
                  <hr>
                </div>
              </div>



            

            </form>
          </div>
        </div>
      </div>
    </div>

    
  </div>
    
    

    <script src="js/jquery-3.3.1.min.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/main.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

    <script
  src="https://code.jquery.com/jquery-3.7.1.min.js"
  integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
  crossorigin="anonymous"></script>
    <script>
 

        $(document).ready(()=>{
            $('#cpf').on('input', function() {
                let value = $(this).val();
                value = value.replace(/\D/g, ''); // Remove caracteres não numéricos
                if (value.length > 3) {
                    value = value.replace(/(\d{3})(\d)/, '$1.$2'); // Insere o primeiro ponto após os primeiros 3 dígitos
                }
                if (value.length > 6) {
                    value = value.replace(/(\d{3})(\d)/, '$1.$2'); // Insere o segundo ponto após os segundos 3 dígitos
                }
                if (value.length > 9) {
                    value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2'); // Insere o traço após os últimos 3 dígitos
                }
                $(this).val(value);
            });
            $("#btnSave").prop("disabled", true);
            $("#meuCheckbox").change(function(){
                if($(this).is(":checked")) {
                    $("#btnSave").attr("disabled", false);
   
                } else {
                    $("#btnSave").prop("disabled", true);
                }
            });
            $("#ctnqrCode").hide();

            $('#bt').click(function () {
                doc.fromHTML($('body').html(), 15, 15, {
                    'width': 170,
                        'elementHandlers': specialElementHandlers
                });
                myBlob = doc.save('blob');
            });
        })
        document.getElementById('dataForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const formData = new FormData(this);
            const data = {};
            formData.forEach((value, key) => {
                data[key] = value;
            });
            generateQR(data);
        });
            function capture() {
                const captureElement = document.querySelector('#ctnqrCode') // Select the element you want to capture. Select the <body> element to capture full page.
                html2canvas(captureElement)
                    .then(canvas => {
                        canvas.style.display = 'none'
                        document.body.appendChild(canvas)
                        return canvas
                    })
                    .then(canvas => {
                        const image = canvas.toDataURL('image/png')
                        const a = document.createElement('a')
                        a.setAttribute('download', 'my-image.png')
                        a.setAttribute('href', image)
                        a.click()
                        canvas.remove()
                    })
            }

            const btn = document.querySelector('#btn')
        btn.addEventListener('click', capture)


        function generateQR(data) {
            fetch('/api/generateQR', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(data => {
                if(data.valido){

                    $("#ctnqrCode").show();
                    $("#btnSave").attr("disabled", true);  
                    const qrCodeContainer = document.getElementById('qrCodeContainer');
                    qrCodeContainer.innerHTML = `<img src="${data.qrCode}" alt="QR Code">`;

                    window.scrollTo(0, document.body.scrollHeight);
                    $("input[type='text']").attr("disabled", true);
                    $("input[type='email']").attr("disabled", true);

                    $("#resultNome").val($("#nome").val());
                    $("#resultCPF").val($("#cpf").val());

                    $("#resultPlaca").val($("#placaMoto").val());


                }else if(data.message == "ER_DUP_ENTRY"){
                    alert("Já existe um registro com essa CNH.")
              
                }else{
                    alert("Erro: " + data.message + ". Favor contactar a oraganização.")
                }
                
            })
            .catch(error => console.error('Error:', error));
        }
    </script>
</body>
</html>